<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procedural Sedation Record (RCEM) - Rich Text</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-100 text-slate-900 antialiased pb-10">

    <header class="bg-white shadow-sm sticky top-0 z-50 border-b border-slate-300 no-print">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <img src="https://iili.io/KGQOvkl.md.png" alt="Logo" class="h-16 md:h-20 w-auto object-contain" onerror="this.style.display='none'">
                <div>
                    <h1 class="text-xl md:text-2xl font-black text-slate-900 leading-tight">Sedation Record <span class="text-xs font-normal text-slate-500 bg-slate-100 px-2 py-0.5 rounded border ml-2">RCEM 2022</span></h1>
                    <p class="text-xs text-green-600 font-bold flex items-center gap-1">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> Auto-save enabled
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                 <a href="https://drive.google.com/file/d/1nI7EvvR_6Pg1l_L7c0Z5PevoseCy7Qia/view?usp=sharing" target="_blank" class="hidden sm:inline-flex items-center gap-2 px-3 py-1 text-xs font-bold text-blue-700 bg-blue-50 rounded border border-blue-200 hover:bg-blue-100 transition">
                    Paper Form
                </a>
                <button id="header-print-letter-btn" class="hidden sm:block px-4 py-2 bg-purple-600 text-white text-xs font-bold rounded hover:bg-purple-700 transition border-2 border-purple-800">
                    DISCHARGE LETTER
                </button>
                <button id="header-print-btn" class="px-4 py-2 bg-slate-800 text-white text-xs font-bold rounded hover:bg-slate-700 transition border-2 border-slate-900">
                    PRINT RECORD
                </button>
            </div>
        </div>
    </header>

    <main id="main-app-container" class="container mx-auto px-4 py-6"> 
        
        <div class="no-print mb-6 flex flex-wrap gap-2 sticky top-24 z-40 bg-slate-100/95 backdrop-blur py-2 border-b border-slate-200">
            <span class="text-xs font-bold uppercase text-slate-500 self-center mr-2">Jump to:</span>
            <a href="#sec-patient" class="px-3 py-1 bg-white border border-slate-300 rounded text-xs font-bold text-slate-700 hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300 transition">Patient</a>
            <a href="#sec-assessment" class="px-3 py-1 bg-white border border-slate-300 rounded text-xs font-bold text-slate-700 hover:bg-orange-50 hover:text-orange-700 hover:border-orange-300 transition">Assessment</a>
            <a href="#sec-plan" class="px-3 py-1 bg-white border border-slate-300 rounded text-xs font-bold text-slate-700 hover:bg-green-50 hover:text-green-700 hover:border-green-300 transition">Plan</a>
            <a href="#sec-intra" class="px-3 py-1 bg-white border border-slate-300 rounded text-xs font-bold text-slate-700 hover:bg-slate-50 hover:text-slate-800 hover:border-slate-400 transition">Intra-Sedation</a>
            <a href="#sec-outcome" class="px-3 py-1 bg-white border border-slate-300 rounded text-xs font-bold text-slate-700 hover:bg-purple-50 hover:text-purple-700 hover:border-purple-300 transition">Outcome</a>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

            <div class="lg:col-span-8 flex flex-col gap-6">

                <div class="hidden print-header mb-6 text-center border-b-2 border-slate-800 pb-4">
                     <h1 class="text-3xl font-black text-slate-900">Procedural Sedation Record</h1>
                     <p class="text-sm text-slate-500 font-bold">RCEM Best Practice Guidelines (2022)</p>
                </div>

                <form id="sedation-form" onsubmit="return false;">
                    
                    <div class="flex flex-col gap-6">

                        <div id="sec-patient" class="section-card border-l-[8px] border-l-blue-600">
                            <div class="section-title text-blue-800">1. Patient & Procedure</div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="md:col-span-4 bg-yellow-50 p-2 border border-yellow-200 rounded mb-2 flex items-center gap-3">
                                    <label class="flex items-center gap-2 font-bold text-slate-800 cursor-pointer text-sm">
                                        <input type="checkbox" id="senior-aware" class="w-5 h-5 text-blue-600 rounded border-slate-400">
                                        Senior in Department Aware?
                                    </label>
                                </div>

                                <div>
                                    <label for="age">Age</label>
                                    <input type="number" id="age" placeholder="Yr" class="font-bold border-slate-400 rounded-md">
                                </div>
                                <div class="md:col-span-1">
                                    <label for="weight">Weight (kg) <span class="text-red-500">*</span></label>
                                    <div class="flex items-center gap-2">
                                        <input type="number" id="weight" placeholder="kg" class="font-bold border-slate-400 rounded-md">
                                        <label class="flex items-center gap-1 bg-slate-100 px-2 py-2 rounded border border-slate-400 cursor-pointer h-[42px] mt-[1px] hover:bg-slate-200">
                                            <input type="checkbox" id="weight-estimated" class="w-4 h-4 text-blue-600 rounded border-slate-400">
                                            <span class="text-[10px] uppercase font-bold text-slate-600">Est</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="md:col-span-2">
                                    <label for="allergies">Allergies</label>
                                    <input type="text" id="allergies" placeholder="Reaction details..." class="text-red-700 font-bold border-slate-400 rounded-md">
                                </div>
                                <div class="md:col-span-4">
                                    <label for="pre-analgesia">Pre-Sedation Analgesia</label>
                                    <input type="text" id="pre-analgesia" placeholder="e.g. IV Morphine 10mg @ 14:00" class="border-slate-400 rounded-md">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="procedure">Procedure</label>
                                    <input type="text" id="procedure" class="border-slate-400 rounded-md">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="indication">Indication</label>
                                    <input type="text" id="indication" class="border-slate-400 rounded-md">
                                </div>
                                
                                <div class="md:col-span-4 mt-2 pt-2 border-t border-slate-200 grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div><label>Sedationist</label><input type="text" id="sedationist" class="border-slate-400 rounded-md"></div>
                                    <div><label>Grade</label><input type="text" id="sedationist-grade" placeholder="e.g. SpR / EM-ACPs" class="border-slate-400 rounded-md"></div>
                                    <div><label>Procedure Dr</label><input type="text" id="procedure-doctor" class="border-slate-400 rounded-md"></div>
                                    <div><label>Nurse</label><input type="text" id="nurse" class="border-slate-400 rounded-md"></div>
                                </div>
                            </div>

                            <div class="sub-card bg-blue-50 border-blue-200 mt-4 no-print">
                                <div class="flex justify-between items-center mb-2">
                                    <label class="text-blue-900 font-black">Estimated Dose Guide (Adults)</label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" id="frail-elderly" class="rounded text-blue-600 border-blue-400">
                                        <span class="text-xs text-blue-800 font-bold">Frail / >65?</span>
                                    </label>
                                </div>
                                <button type="button" id="calculate-doses-button" class="w-full std-btn bg-white border-blue-300 text-blue-700 hover:bg-blue-100">
                                    Calculate Ranges
                                </button>
                                <div id="dose-output" class="mt-2 p-2 bg-white rounded border border-blue-200 text-sm font-mono hidden text-blue-900"></div>
                            </div>
                        </div>

                        <div id="sec-assessment" class="section-card border-l-[8px] border-l-orange-500">
                            <div class="section-title text-orange-800">2. Pre-Sedation Assessment</div>
                            
                            <div class="flex flex-col gap-4">
                                
                                <div class="sub-card mt-0 border-orange-200 bg-orange-50/50">
                                    <label class="border-b border-orange-200 pb-1 mb-3 text-orange-900">Consent & Capacity</label>
                                    <div class="flex flex-col gap-3">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-bold text-slate-700">Does patient have capacity?</span>
                                            <div class="flex bg-white rounded p-1 border border-slate-300">
                                                <label class="cursor-pointer px-3 py-1"><input type="radio" name="capacity" value="Yes" checked class="hidden peer"><span class="text-xs font-bold text-slate-400 peer-checked:text-blue-600 peer-checked:underline">Yes</span></label>
                                                <label class="cursor-pointer px-3 py-1"><input type="radio" name="capacity" value="No" class="hidden peer"><span class="text-xs font-bold text-slate-400 peer-checked:text-red-600 peer-checked:underline">No</span></label>
                                            </div>
                                        </div>
                                        
                                        <div id="capacity-no-options" class="hidden pl-4 border-l-4 border-red-300 ml-1 bg-red-50 p-2 rounded-r">
                                             <label class="flex items-center gap-2 font-bold cursor-pointer text-xs mb-1"><input type="radio" name="consent-type" value="Best Interests" class="rounded text-red-600 border-red-400"> Best Interests Form Completed</label>
                                             <label class="flex items-center gap-2 font-bold cursor-pointer text-xs"><input type="radio" name="consent-type" value="Emergency" class="rounded text-red-600 border-red-400"> Emergency Doctrine</label>
                                        </div>

                                        <div id="capacity-yes-options" class="pl-0">
                                             <div class="flex gap-4 mb-3">
                                                <label class="flex items-center gap-2 font-bold text-slate-700 cursor-pointer text-xs"><input type="radio" name="consent-type" value="Written" class="text-blue-600 border-slate-400 focus:ring-blue-500 w-4 h-4"> Written Consent</label>
                                                <label class="flex items-center gap-2 font-bold text-slate-700 cursor-pointer text-xs"><input type="radio" name="consent-type" value="Verbal" class="text-blue-600 border-slate-400 focus:ring-blue-500 w-4 h-4"> Verbal Consent</label>
                                             </div>
                                             <div class="grid grid-cols-2 gap-2 border-t border-slate-200 pt-2">
                                                <label class="flex items-center gap-2 font-medium cursor-pointer text-xs text-slate-600"><input type="checkbox" id="consent-leaflet" class="rounded text-green-600 border-slate-400"> Information Leaflet Given</label>
                                                <label class="flex items-center gap-2 font-medium cursor-pointer text-xs text-slate-600"><input type="checkbox" id="consent-questions" class="rounded text-green-600 border-slate-400"> Questions Answered</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="sub-card mt-0 border-slate-300">
                                    <label class="border-b border-slate-200 pb-1 mb-2">Risk Discussion & Frequency (RCEM)</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 px-2">
                                        <div>
                                            <span class="text-[10px] font-black text-slate-500 uppercase mb-1 block">Common (>1 in 100)</span>
                                            <div class="space-y-1">
                                                <label class="flex items-center gap-2 font-medium text-xs text-slate-700"><input id="risk-nausea" type="checkbox" class="rounded border-slate-400"> Nausea / Vomiting</label>
                                                <label class="flex items-center gap-2 font-medium text-xs text-slate-700"><input id="risk-drowsy" type="checkbox" class="rounded border-slate-400"> Drowsiness / Ataxia</label>
                                                <label class="flex items-center gap-2 font-medium text-xs text-slate-700"><input id="risk-hypotension" type="checkbox" class="rounded border-slate-400"> Hypotension (~1 in 50)</label>
                                                <label class="flex items-center gap-2 font-medium text-xs text-slate-700"><input id="risk-resp-depress" type="checkbox" class="rounded border-slate-400"> Resp. Depression/Hypoxia (~1 in 50)</label>
                                            </div>
                                        </div>
                                        <div>
                                            <span class="text-[10px] font-black text-red-700 uppercase mb-1 block">Rare (~1 in 1000)</span>
                                            <div class="space-y-1">
                                                <label class="flex items-center gap-2 font-bold text-xs text-red-900"><input id="risk-laryngospasm" type="checkbox" class="rounded border-red-300"> Laryngospasm (1:1000)</label>
                                                <label class="flex items-center gap-2 font-bold text-xs text-red-900"><input id="risk-aspiration" type="checkbox" class="rounded border-red-300"> Aspiration (1:1000 - 1:3000)</label>
                                                <label class="flex items-center gap-2 font-bold text-xs text-red-900"><input id="risk-allergy" type="checkbox" class="rounded border-red-300"> Anaphylaxis</label>
                                            </div>
                                        </div>
                                        <div class="md:col-span-2 border-t border-slate-200 pt-2">
                                            <span class="text-[10px] font-black text-slate-500 uppercase mb-1 block">Procedure Outcomes</span>
                                            <div class="flex flex-wrap gap-4">
                                                <label class="flex items-center gap-2 font-medium text-xs text-slate-700"><input id="risk-failure" type="checkbox" class="rounded border-slate-400"> Failure of Procedure (May need GA)</label>
                                                <label class="flex items-center gap-2 font-medium text-xs text-slate-700"><input id="risk-treatment" type="checkbox" class="rounded border-slate-400"> Need for further treatment / admission</label>
                                                <label class="flex items-center gap-2 font-medium text-xs text-slate-700"><input id="risk-emergence" type="checkbox" class="rounded border-slate-400"> Emergence Reaction (Ketamine)</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="sub-card mt-0 border-slate-300">
                                    <label>Fasting Status</label>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div><span class="text-[10px] uppercase font-bold text-slate-500">Food</span><input type="time" id="last-food" class="border-slate-400 rounded-md"></div>
                                        <div><span class="text-[10px] uppercase font-bold text-slate-500">Clear Fluid</span><input type="time" id="last-fluid" class="border-slate-400 rounded-md"></div>
                                    </div>
                                </div>
                                
                                <div class="sub-card mt-0 border-slate-300">
                                    <label class="border-b border-slate-200 pb-1 mb-2">Airway Assessment</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="border-r md:border-slate-200 pr-2">
                                            <span class="text-[10px] font-bold text-slate-500 uppercase block mb-1">Mallampati Score</span>
                                            <div class="flex items-start gap-2">
                                                 <img src="images/Mallampati.jpg" alt="Mallampati" class="w-16 h-auto object-contain border rounded cursor-pointer hover:scale-150 transition origin-top-left bg-white">
                                                 <div class="flex-1 grid grid-cols-2 gap-1">
                                                     <label class="cursor-pointer text-center"><input type="radio" name="airway-mallampati" value="I" class="sr-only peer"><div class="px-2 py-1 border border-slate-300 rounded text-xs peer-checked:bg-blue-600 peer-checked:text-white transition">Class I</div></label>
                                                     <label class="cursor-pointer text-center"><input type="radio" name="airway-mallampati" value="II" class="sr-only peer"><div class="px-2 py-1 border border-slate-300 rounded text-xs peer-checked:bg-blue-600 peer-checked:text-white transition">Class II</div></label>
                                                     <label class="cursor-pointer text-center"><input type="radio" name="airway-mallampati" value="III" class="sr-only peer"><div class="px-2 py-1 border border-amber-300 bg-amber-50 rounded text-xs peer-checked:bg-amber-600 peer-checked:text-white transition">Class III</div></label>
                                                     <label class="cursor-pointer text-center"><input type="radio" name="airway-mallampati" value="IV" class="sr-only peer"><div class="px-2 py-1 border border-red-300 bg-red-50 rounded text-xs peer-checked:bg-red-600 peer-checked:text-white transition">Class IV</div></label>
                                                 </div>
                                            </div>
                                        </div>
                                
                                        <div>
                                            <span class="text-[10px] font-bold text-slate-500 uppercase block mb-1">Upper Lip Bite Test</span>
                                            <div class="flex items-start gap-2">
                                                 <img src="images/upperlipbitetest.png" alt="ULBT" class="w-16 h-auto object-contain border rounded cursor-pointer hover:scale-150 transition origin-top-left bg-white">
                                                 <div class="flex-1 grid grid-cols-1 gap-1">
                                                     <label class="cursor-pointer"><input type="radio" name="airway-ulbt" value="1" class="sr-only peer"><div class="px-2 py-1 border border-slate-300 rounded text-xs peer-checked:bg-blue-600 peer-checked:text-white transition text-center">Class 1 (Lower incisors bite upper lip)</div></label>
                                                     <label class="cursor-pointer"><input type="radio" name="airway-ulbt" value="2" class="sr-only peer"><div class="px-2 py-1 border border-slate-300 rounded text-xs peer-checked:bg-blue-600 peer-checked:text-white transition text-center">Class 2 (Can bite mucosa only)</div></label>
                                                     <label class="cursor-pointer"><input type="radio" name="airway-ulbt" value="3" class="sr-only peer"><div class="px-2 py-1 border border-red-300 bg-red-50 rounded text-xs peer-checked:bg-red-600 peer-checked:text-white transition text-center">Class 3 (Cannot bite upper lip)</div></label>
                                                 </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-3 pt-2 border-t border-slate-200">
                                        <span class="text-[10px] font-bold text-slate-500 uppercase block mb-1">Difficult Airway Predictors</span>
                                        <div class="flex flex-wrap gap-3">
                                             <label class="flex items-center gap-2 font-medium text-xs text-slate-700 cursor-pointer"><input id="airway-mouth" type="checkbox" class="rounded text-red-600 border-slate-400"> Mouth Opening &lt;3cm</label>
                                             <label class="flex items-center gap-2 font-medium text-xs text-slate-700 cursor-pointer"><input id="airway-tmd" type="checkbox" class="rounded text-red-600 border-slate-400"> Thyromental &lt;6cm</label>
                                             <label class="flex items-center gap-2 font-medium text-xs text-slate-700 cursor-pointer"><input id="airway-neck" type="checkbox" class="rounded text-red-600 border-slate-400"> Limited Neck Mobility</label>
                                             <label class="flex items-center gap-2 font-medium text-xs text-slate-700 cursor-pointer"><input id="airway-bmi" type="checkbox" class="rounded text-red-600 border-slate-400"> BMI &gt;35</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="sub-card border-slate-300 mt-0 relative">
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="mb-0 flex items-center gap-4">
                                            ASA Grade
                                            <span class="flex items-center gap-1 cursor-pointer ml-4">
                                                <input type="checkbox" id="asa-emergency" class="w-4 h-4 text-red-600 rounded border-red-400 focus:ring-red-500">
                                                <span class="text-xs font-bold text-red-600">Emergency (E)</span>
                                            </span>
                                        </label>
                                        <button type="button" id="asa-guide-button" class="text-[10px] bg-slate-200 px-2 rounded font-bold hover:bg-slate-300 no-print">?</button>
                                    </div>
                                    <div id="asa-guide-content" class="hidden text-xs text-slate-600 mb-2 p-2 bg-slate-100 rounded border border-slate-300">
                                        I:Healthy, II:Mild, III:Severe, IV:Threat to life
                                    </div>
                                    
                                    <div id="asa-high-alert" class="hidden bg-red-100 border-l-4 border-red-600 text-red-800 p-3 mb-3 text-sm font-bold shadow-sm">
                                        ‚ö†Ô∏è CAUTION: ASA Grade III or higher requires careful consideration as to whether it is appropriate to be done in ED.
                                    </div>

                                    <div class="flex justify-between gap-1">
                                        <label class="cursor-pointer text-center flex-1"><input type="radio" name="asa-grade" value="I" class="sr-only peer"><div class="py-2 border-2 border-slate-300 rounded-md peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-700 text-xs font-bold transition hover:bg-slate-50">I</div></label>
                                        <label class="cursor-pointer text-center flex-1"><input type="radio" name="asa-grade" value="II" class="sr-only peer"><div class="py-2 border-2 border-slate-300 rounded-md peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-700 text-xs font-bold transition hover:bg-slate-50">II</div></label>
                                        <label class="cursor-pointer text-center flex-1"><input type="radio" name="asa-grade" value="III" class="sr-only peer"><div class="py-2 border-2 border-amber-200 bg-amber-50 text-amber-800 rounded-md peer-checked:bg-amber-600 peer-checked:text-white peer-checked:border-amber-700 text-xs font-bold transition hover:bg-amber-100">III</div></label>
                                        <label class="cursor-pointer text-center flex-1"><input type="radio" name="asa-grade" value="IV" class="sr-only peer"><div class="py-2 border-2 border-red-200 bg-red-50 text-red-800 rounded-md peer-checked:bg-red-600 peer-checked:text-white peer-checked:border-red-700 text-xs font-bold transition hover:bg-red-100">IV</div></label>
                                        <label class="cursor-pointer text-center flex-1"><input type="radio" name="asa-grade" value="V" class="sr-only peer"><div class="py-2 border-2 border-red-200 bg-red-50 text-red-800 rounded-md peer-checked:bg-red-600 peer-checked:text-white peer-checked:border-red-700 text-xs font-bold transition hover:bg-red-100">V</div></label>
                                    </div>
                                </div>
                                
                                <div class="bg-red-50 border border-red-200 p-3 rounded-lg">
                                    <label class="text-red-800">Contraindications</label>
                                    <div class="space-y-1 mt-1">
                                        <label class="flex items-center gap-2 font-bold text-xs text-red-700 cursor-pointer"><input id="ci-allergy" type="checkbox" class="text-red-600 rounded border-red-300"> Known Allergy</label>
                                        <label class="flex items-center gap-2 font-bold text-xs text-red-700 cursor-pointer"><input id="ci-hemo" type="checkbox" class="text-red-600 rounded border-red-300"> Haemodynamic Instability</label>
                                        <label class="flex items-center gap-2 font-bold text-xs text-red-700 cursor-pointer"><input id="ci-gcs" type="checkbox" class="text-red-600 rounded border-red-300"> Compromised Airway / GCS</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="sec-plan" class="section-card border-l-[8px] border-l-green-500">
                            <div class="section-title text-green-800">3. Plan & Preparation</div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label>Target Level</label>
                                    <select id="plan-target" class="border-slate-400 rounded-md">
                                        <option>Minimal (Anxiolysis)</option>
                                        <option>Moderate (Conscious)</option>
                                        <option>Deep</option>
                                        <option>Dissociation</option>
                                    </select>
                                </div>
                                <div>
                                    <label>Primary Agent(s)</label>
                                    <input type="text" id="plan-agent" placeholder="e.g. Propofol" class="border-slate-400 rounded-md">
                                </div>
                            </div>

                            <div class="sub-card mt-4 border-slate-300">
                                <label class="mb-2 block">SOAP-ME Checklist</label>
                                <div class="flex flex-wrap gap-3">
                                    <label class="flex items-center gap-2 p-2 bg-white border border-slate-300 rounded cursor-pointer hover:bg-green-50"><input id="soap-s" type="checkbox" class="rounded text-green-600 border-slate-400"> <span class="font-semibold text-sm">Suction</span></label>
                                    <label class="flex items-center gap-2 p-2 bg-white border border-slate-300 rounded cursor-pointer hover:bg-green-50"><input id="soap-o" type="checkbox" class="rounded text-green-600 border-slate-400"> <span class="font-semibold text-sm">Oxygen/BVM</span></label>
                                    <label class="flex items-center gap-2 p-2 bg-white border border-slate-300 rounded cursor-pointer hover:bg-green-50"><input id="soap-a" type="checkbox" class="rounded text-green-600 border-slate-400"> <span class="font-semibold text-sm">Airway</span></label>
                                    <label class="flex items-center gap-2 p-2 bg-white border border-slate-300 rounded cursor-pointer hover:bg-green-50"><input id="soap-m" type="checkbox" class="rounded text-green-600 border-slate-400"> <span class="font-semibold text-sm">Monitoring</span></label>
                                    <label class="flex items-center gap-2 p-2 bg-white border border-slate-300 rounded cursor-pointer hover:bg-green-50"><input id="soap-e" type="checkbox" class="rounded text-green-600 border-slate-400"> <span class="font-semibold text-sm">Env/IV</span></label>
                                </div>
                            </div>

                            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3">
                                <input id="plan-aagbi" type="checkbox" class="mt-1 w-5 h-5 rounded text-blue-600 focus:ring-blue-500 border-blue-400">
                                <div>
                                    <span class="block text-sm font-black text-blue-900">AAGBI Standard Monitoring Confirmed</span>
                                    <span class="text-xs text-blue-700 font-bold">ECG, NIBP, SpO2 & <strong>Waveform Capnography</strong> (Continuous)</span>
                                </div>
                            </div>

                            <div class="mt-4">
                                <label>Pre-Sedation Vitals</label>
                                <div class="grid grid-cols-4 gap-2">
                                    <input type="text" id="pre-vital-hr" placeholder="HR" class="text-center font-mono font-bold border-slate-400 rounded-md">
                                    <input type="text" id="pre-vital-bp" placeholder="BP" class="text-center font-mono font-bold border-slate-400 rounded-md">
                                    <input type="text" id="pre-vital-spo2" placeholder="SpO2" class="text-center font-mono font-bold border-slate-400 rounded-md">
                                    <input type="text" id="pre-vital-rr" placeholder="RR" class="text-center font-mono font-bold border-slate-400 rounded-md">
                                </div>
                            </div>
                        </div>

                        <div class="section-card border-l-[8px] border-l-yellow-400 bg-yellow-50/50">
                            <div class="section-title text-yellow-800 border-yellow-200 flex items-center gap-2">
                                <span>üõë Safety Time Out</span>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                 <label class="flex items-center gap-2 font-bold text-slate-800 cursor-pointer border border-yellow-200 bg-white p-3 rounded shadow-sm hover:bg-yellow-50 transition"><input id="to-identity" type="checkbox" class="w-5 h-5 text-yellow-600 rounded border-yellow-400 focus:ring-yellow-500"> Patient ID Confirmed</label>
                                 <label class="flex items-center gap-2 font-bold text-slate-800 cursor-pointer border border-yellow-200 bg-white p-3 rounded shadow-sm hover:bg-yellow-50 transition"><input id="to-role" type="checkbox" class="w-5 h-5 text-yellow-600 rounded border-yellow-400 focus:ring-yellow-500"> Roles Assigned</label>
                                 <label class="flex items-center gap-2 font-bold text-slate-800 cursor-pointer border border-yellow-200 bg-white p-3 rounded shadow-sm hover:bg-yellow-50 transition"><input id="to-site" type="checkbox" class="w-5 h-5 text-yellow-600 rounded border-yellow-400 focus:ring-yellow-500"> Site/Proc Confirmed</label>
                                 <label class="flex items-center gap-2 font-bold text-slate-800 cursor-pointer border border-yellow-200 bg-white p-3 rounded shadow-sm hover:bg-yellow-50 transition"><input id="to-monitoring" type="checkbox" class="w-5 h-5 text-yellow-600 rounded border-yellow-400 focus:ring-yellow-500"> Monitoring Active</label>
                            </div>
                        </div>

                        <div id="sec-intra" class="section-card border-l-[8px] border-l-slate-800 page-break">
                            <div class="section-title text-slate-800">
                                4. Intra-Sedation Record
                                <button type="button" id="complications-guide-button" class="text-[10px] bg-slate-200 px-2 py-1 rounded hover:bg-slate-300 no-print">Guide</button>
                            </div>
                            
                            <div id="complications-guide-content" class="hidden mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-xs">
                                 <strong class="block mb-1 text-sm text-yellow-900">Quick Reference - Adverse Events & Intervention (TROOPS/SIVA):</strong>
                                 <ul class="list-disc ml-4 space-y-1 text-slate-700">
                                    <li><strong>Apnoea:</strong> Stimulate/Airway/BVM.</li>
                                    <li><strong>Laryngospasm:</strong> 100% O‚ÇÇ / Jaw Thrust (Larson's) / Succinylcholine if refractory.</li>
                                    <li><strong>Hypotension:</strong> IV Fluids / Vasoactive drugs (e.g., Metaraminol).</li>
                                    <li><strong>Agitation:</strong> Reassurance / Benzodiazepine.</li>
                                 </ul>
                            </div>

                            <div class="bg-slate-800 rounded-xl p-5 text-white shadow-md mb-6 no-print border-2 border-slate-900">
                                <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                                    <div class="text-center md:text-left">
                                        <div class="text-xs font-bold text-slate-400 uppercase">Sedation Timer</div>
                                        <div id="timer-display" class="text-5xl font-mono font-black tracking-widest text-white">00:00:00</div>
                                    </div>
                                    <button type="button" id="sedation-timer-button" class="std-btn bg-green-600 text-white border-green-700 hover:bg-green-700 w-full md:w-auto text-lg py-3 shadow-lg">
                                        START TIMER
                                    </button>
                                </div>
                                <div class="grid grid-cols-3 gap-2 mt-4 pt-4 border-t border-slate-700">
                                    <div class="text-center">
                                        <button type="button" id="procedure-start-button" class="w-full py-2 text-xs bg-slate-700 hover:bg-slate-600 rounded text-slate-200 font-bold mb-1 border border-slate-600">Proc Start</button>
                                        <span id="procedure-start-output" class="text-xs font-mono text-green-400 block h-4 font-bold"></span>
                                    </div>
                                    <div class="text-center">
                                        <button type="button" id="procedure-end-button" class="w-full py-2 text-xs bg-slate-700 hover:bg-slate-600 rounded text-slate-200 font-bold mb-1 border border-slate-600">Proc End</button>
                                        <span id="procedure-end-output" class="text-xs font-mono text-green-400 block h-4 font-bold"></span>
                                    </div>
                                    <div class="text-center">
                                        <button type="button" id="patient-awake-button" class="w-full py-2 text-xs bg-slate-700 hover:bg-slate-600 rounded text-slate-200 font-bold mb-1 border border-slate-600">Awake</button>
                                        <span id="patient-awake-output" class="text-xs font-mono text-green-400 block h-4 font-bold"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-6">
                                <label class="mb-2 block">Drug Administration</label>
                                <div id="drug-admin-container" class="flex flex-wrap gap-2 mb-3 no-print">
                                    <button type="button" class="drug-btn text-indigo-700 border-indigo-200 bg-indigo-50" data-drug="Propofol">Propofol</button>
                                    <button type="button" class="drug-btn text-orange-700 border-orange-200 bg-orange-50" data-drug="Ketamine">Ketamine</button>
                                    <button type="button" class="drug-btn text-blue-700 border-blue-200 bg-blue-50" data-drug="Midazolam">Midazolam</button>
                                    <button type="button" class="drug-btn text-purple-700 border-purple-200 bg-purple-50" data-drug="Fentanyl">Fentanyl</button>
                                    <button type="button" class="drug-btn" data-drug="Other">Other</button>
                                </div>
                                <div class="overflow-x-auto border-2 border-slate-300 rounded-lg">
                                    <table class="min-w-full divide-y divide-slate-200">
                                        <thead class="bg-slate-100">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-[10px] font-bold text-slate-600 uppercase">Time</th>
                                                <th class="px-3 py-2 text-left text-[10px] font-bold text-slate-600 uppercase">Drug</th>
                                                <th class="px-3 py-2 text-left text-[10px] font-bold text-slate-600 uppercase">Dose (mg)</th>
                                                <th class="px-3 py-2 text-left text-[10px] font-bold text-slate-600 uppercase">Given By</th>
                                                <th class="px-3 py-2 w-8 no-print"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="drug-table-body" class="divide-y divide-slate-100 bg-white text-sm"></tbody>
                                    </table>
                                </div>
                            </div>

                            <div>
                                 <div class="flex justify-between items-end mb-2">
                                    <label>Monitoring Log (q5min)</label>
                                    <button type="button" id="add-obs-button" class="std-btn py-1 text-xs bg-green-50 text-green-700 border-green-200 hover:bg-green-100 no-print">+ Add Obs</button>
                                 </div>
                                 
                                 <div id="obs-toast" class="hidden bg-yellow-100 text-yellow-800 p-2 rounded mb-2 text-xs flex justify-between items-center border border-yellow-300">
                                    <span>&#9200; <strong>5 Minute Alert</strong></span>
                                    <button id="dismiss-toast-button" class="font-bold underline">OK</button>
                                 </div>

                                 <div class="overflow-x-auto border-2 border-slate-300 rounded-lg">
                                    <table class="min-w-full divide-y divide-slate-200">
                                        <thead class="bg-slate-100">
                                            <tr>
                                                <th class="px-2 py-2 text-[10px] font-bold text-slate-600 uppercase">Time</th>
                                                <th class="px-2 py-2 text-[10px] font-bold text-slate-600 uppercase">HR</th>
                                                <th class="px-2 py-2 text-[10px] font-bold text-slate-600 uppercase">BP</th>
                                                <th class="px-2 py-2 text-[10px] font-bold text-slate-600 uppercase">SpO2</th>
                                                <th class="px-2 py-2 text-[10px] font-bold text-slate-600 uppercase">RR</th>
                                                <th class="px-2 py-2 text-[10px] font-bold text-slate-600 uppercase">EtCO2</th>
                                                <th class="px-2 py-2 text-[10px] font-bold text-slate-600 uppercase w-24">Score</th>
                                                <th class="px-2 py-2 w-8 no-print"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="monitoring-log-body" class="divide-y divide-slate-100 bg-white text-sm"></tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="mt-4 bg-red-50 border border-red-200 p-3 rounded-lg">
                                <label class="text-red-900">Complications & Interventions</label>
                                <textarea id="complications-notes" rows="2" placeholder="Describe any adverse events, what happened, and what was done..." class="w-full p-2 border border-red-300 rounded-md text-sm font-medium bg-white"></textarea>
                            </div>

                            <div class="mt-4">
                                <label>General Notes <span class="text-xs font-normal text-slate-500">(Consider TROOPS Intermediate/Sentinel reporting)</span></label>
                                <textarea id="general-notes" rows="4" class="w-full p-2 border border-slate-400 rounded-md text-sm font-medium"></textarea>
                            </div>
                        </div>

                        <div id="sec-outcome" class="section-card border-l-[8px] border-l-purple-600">
                            <div class="section-title text-purple-800">5. Outcome & Discharge</div>
                            
                            <div class="flex flex-col gap-4">
                                <div class="sub-card bg-white mt-0 border-slate-300">
                                    <label>Procedure Outcome</label>
                                    <div class="flex gap-4 mt-2">
                                        <label class="flex items-center gap-2 font-bold text-slate-700 cursor-pointer"><input type="radio" name="outcome-proc" value="Successful" class="text-blue-600 border-slate-400 w-5 h-5"> Successful</label>
                                        <label class="flex items-center gap-2 font-bold text-slate-700 cursor-pointer"><input type="radio" name="outcome-proc" value="Unsuccessful" class="text-blue-600 border-slate-400 w-5 h-5"> Unsuccessful</label>
                                    </div>
                                </div>
                                <div class="sub-card bg-white mt-0 border-slate-300">
                                    <label>Discharge Criteria (RCEM Box 3)</label>
                                    <div class="space-y-2 mt-2 text-sm text-slate-700">
                                        <label class="flex items-center gap-2 font-medium cursor-pointer"><input type="checkbox" id="dc-vitals" class="rounded text-blue-600 border-slate-400"> Vital signs returned to baseline (No supplementary O‚ÇÇ)</label>
                                        <label class="flex items-center gap-2 font-medium cursor-pointer"><input type="checkbox" id="dc-aao" class="rounded text-blue-600 border-slate-400"> Alert & Orientated (Baseline GCS)</label>
                                        <label class="flex items-center gap-2 font-medium cursor-pointer"><input type="checkbox" id="dc-oral" class="rounded text-blue-600 border-slate-400"> Able to tolerate oral fluids (No vomiting)</label>
                                        <label class="flex items-center gap-2 font-medium cursor-pointer"><input type="checkbox" id="dc-pain" class="rounded text-blue-600 border-slate-400"> Adequate analgesia / minimal nausea</label>
                                        <label class="flex items-center gap-2 font-medium cursor-pointer"><input type="checkbox" id="dc-home" class="rounded text-blue-600 border-slate-400"> Appropriate care available at home</label>
                                        <label class="flex items-center gap-2 font-medium cursor-pointer"><input type="checkbox" id="dc-reversal-time" class="rounded text-red-600 border-red-400"> 2 hours elapsed since use of reversal agent</label>
                                    </div>
                                    <label class="mt-4 pt-2 border-t border-slate-200 block text-xs font-bold text-slate-500">Post-Discharge Instructions Given (48h)</label>
                                    <div class="space-y-1 mt-1 text-sm text-slate-700">
                                        <label class="flex items-center gap-2 font-medium cursor-pointer"><input type="checkbox" id="di-drive" class="rounded text-purple-600 border-slate-400"> No driving / operating heavy machinery</label>
                                        <label class="flex items-center gap-2 font-medium cursor-pointer"><input type="checkbox" id="di-adult" class="rounded text-purple-600 border-slate-400"> Accompanied home by responsible person / 24h care</label>
                                        <label class="flex items-center gap-2 font-medium cursor-pointer"><input type="checkbox" id="di-alcohol" class="rounded text-purple-600 border-slate-400"> No alcohol / avoid strenuous exercise</label>
                                        <label class="flex items-center gap-2 font-medium cursor-pointer"><input type="checkbox" id="di-decisions" class="rounded text-purple-600 border-slate-400"> No legal decisions or document signing</label>
                                    </div>
                                </div>
                                
                                <div class="sub-card bg-slate-50 mt-0 border-slate-300">
                                    <label class="border-b border-slate-200 pb-1 mb-3">Disposal</label>
                                    <div class="flex gap-4">
                                        <label class="flex items-center gap-2 font-bold text-slate-700 cursor-pointer"><input type="radio" name="disposal" value="Home" class="text-purple-600 border-slate-400 w-5 h-5"> Home</label>
                                        <label class="flex items-center gap-2 font-bold text-slate-700 cursor-pointer"><input type="radio" name="disposal" value="CDU" class="text-purple-600 border-slate-400 w-5 h-5"> CDU</label>
                                        <label class="flex items-center gap-2 font-bold text-slate-700 cursor-pointer"><input type="radio" name="disposal" value="Ward" class="text-purple-600 border-slate-400 w-5 h-5"> Admit to Ward</label>
                                    </div>
                                </div>

                                <div class="sub-card bg-slate-50 mt-0 border-slate-300">
                                    <label class="border-b border-slate-200 pb-1 mb-3">Sign Off</label>
                                    <div class="space-y-3">
                                        <div><label>Name</label><input type="text" id="signoff-name" class="border-slate-400 rounded-md"></div>
                                        <div><label>GMC No</label><input type="text" id="signoff-gmc" class="border-slate-400 rounded-md"></div>
                                        <div><label>Time</label><input type="time" id="signoff-time" class="border-slate-400 rounded-md"></div>
                                    </div>
                                </div>
                                
                                <button type="button" id="create-discharge-letter-btn" class="w-full std-btn bg-purple-600 text-white border-purple-800 hover:bg-purple-700 py-3 text-sm shadow-md">
                                    üìù Create Patient Discharge Letter (Print)
                                </button>
                            </div>
                        </div>
                        
                    </div>

                </form>
            </div> 

            <div class="lg:col-span-4 relative">
                <div class="sticky top-24 h-fit no-print space-y-4">
                    <div id="epr-log-container" class="bg-white p-4 rounded-xl shadow-lg border border-slate-300">
                        <div class="flex justify-between items-center mb-3">
                            <h2 class="text-sm font-bold text-slate-700 uppercase tracking-wide">EPR Quick Log</h2>
                            <button type="button" id="copy-log-button" class="px-3 py-1 text-xs font-bold bg-blue-600 text-white rounded hover:bg-blue-700 transition shadow-sm">
                                Copy Rich Text
                            </button>
                        </div>
                        <div id="epr-log-output" class="rich-output focus:ring-2 ring-blue-500 ring-offset-2" contenteditable="true">
                            </div>
                    </div>

                    <div class="text-center mt-4">
                         <button type="button" id="print-button" class="w-full std-btn bg-slate-800 text-white text-sm py-3 shadow-lg hover:bg-slate-900 border-2 border-slate-900">
                            Print Medical Record
                         </button>
                         <p class="mt-4 text-xs text-slate-500">
                             <a href="#" id="clear-form-button" class="text-red-500 underline font-bold">Reset Form</a>
                         </p>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <div id="discharge-letter-view" class="hidden bg-white p-6 max-w-3xl mx-auto border shadow-2xl mt-8 mb-8 text-slate-900 print:p-0 print:shadow-none print:border-none print:mt-0 print:mb-0">
        <div class="no-print flex justify-between items-center mb-6 border-b pb-4">
            <h2 class="text-xl font-bold text-slate-700">Preview: Patient Discharge Letter</h2>
            <div class="flex gap-2">
                <button id="close-letter-btn" class="px-4 py-2 border rounded hover:bg-slate-100">Back to Form</button>
                <button id="print-letter-btn" class="px-4 py-2 bg-blue-600 text-white font-bold rounded hover:bg-blue-700 shadow">üñ®Ô∏è Print Letter</button>
            </div>
        </div>

        <div class="font-[Inter] leading-snug">
            <div class="border-b-2 border-slate-800 pb-3 mb-4 flex justify-between items-start">
                <div>
                    <h1 class="text-xl font-black uppercase tracking-tight">Emergency Department</h1>
                    <p class="text-base font-bold text-slate-600">Discharge Advice Following Procedural Sedation</p>
                </div>
                <div class="text-right text-xs">
                    <p class="font-bold">Date: <span id="letter-date"></span></p>
                    <p class="text-slate-500">Trust Ref: RCEM/SED/2022</p>
                </div>
            </div>

            <div class="mb-4 text-sm">
                <p class="mb-1"><strong>Patient Name:</strong> <span id="letter-patient-name" class="border-b border-dotted border-slate-400 px-2 min-w-[200px] inline-block font-mono"></span></p>
                <p><strong>Procedure:</strong> <span id="letter-procedure"></span></p>
            </div>

            <p class="mb-2 text-sm font-bold">Dear Patient,</p>
            <p class="mb-4 text-sm text-slate-800">
                Today you received the following medication(s): <span id="letter-drugs-given" class="font-bold"></span>.
                These medicines make you sleepy and relaxed. Even if you feel wide awake now, the medication can stay in your body for up to 24 hours and may affect your judgment, memory, and coordination.
            </p>

            <div class="bg-blue-50 border-l-4 border-blue-600 p-3 mb-4">
                <h3 class="font-bold text-blue-900 mb-1 uppercase text-sm">‚ö†Ô∏è The 24-Hour Safety Rules</h3>
                
                <div class="mb-2 text-sm font-semibold text-blue-800">
                    <p>You received sedation at <span id="letter-time-start" class="border-b border-blue-400 border-dotted font-bold"></span> on <span id="letter-date-start" class="border-b border-blue-400 border-dotted font-bold"></span>.</p>
                    
                    <p class="mt-2 text-slate-900">For your safety, you <strong class="text-red-600 text-base">MUST NOT</strong> do any of the following until <span id="letter-time-end" class="font-black bg-yellow-200 px-1 rounded"></span> on <span id="letter-date-end" class="font-black bg-yellow-200 px-1 rounded"></span> (24 hours later):</p>
                </div>

                <ul class="list-disc ml-5 space-y-1 text-sm text-slate-900 font-bold">
                    <li>Drive a car, ride a bicycle, or operate any machinery.</li>
                    <li>Drink alcohol or take sleeping tablets.</li>
                    <li>Sign legal documents or make important financial decisions.</li>
                    <li>Cook or use sharp implements/kettles without supervision (risk of burns/injury).</li>
                    <li>Be in sole charge of young children.</li>
                </ul>
            </div>

            <div class="mb-4">
                <h3 class="font-bold text-slate-900 border-b border-slate-300 mb-1 pb-1 text-sm">Supervision</h3>
                <p class="text-sm">
                    You have been discharged because you are awake and safe, but you <strong>must be accompanied home by a responsible adult</strong> 
                    who can stay with you for the next 24 hours. Do not go home to an empty house.
                </p>
            </div>

            <div class="mb-4">
                <h3 class="font-bold text-slate-900 border-b border-slate-300 mb-1 pb-1 text-sm">Common Side Effects</h3>
                <ul id="letter-side-effects-list" class="list-disc ml-5 space-y-1 text-sm text-slate-700">
                </ul>
            </div>

            <div class="bg-red-50 border-l-4 border-red-600 p-3 mb-4">
                <h3 class="font-bold text-red-900 mb-1 uppercase text-sm">üõë When to Seek Help</h3>
                <p class="mb-1 text-sm text-red-900">Please return to the Emergency Department or call 111 immediately if you experience:</p>
                <ul class="list-disc ml-5 space-y-1 text-sm text-red-900 font-medium">
                    <li>Severe pain that is not improved by simple painkillers.</li>
                    <li>Persistent vomiting or inability to keep fluids down.</li>
                    <li>Difficulty breathing or chest pain.</li>
                    <li>Fainting or severe drowsiness where you cannot be woken easily.</li>
                </ul>
            </div>

            <div class="mt-4 pt-4 border-t border-slate-200 text-xs text-slate-500">
                <p>This advice sheet is based on RCEM Best Practice Guidelines (2022). If you have any non-urgent concerns, please contact your GP.</p>
                <p class="mt-4">Clinician Signature: __________________________</p>
            </div>
        </div>
    </div>

    <div id="custom-modal-backdrop" class="fixed inset-0 hidden items-center justify-center z-50">
        <div id="custom-modal" class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm mx-4 transform transition-all scale-95 opacity-0 border border-slate-200">
            <h3 id="custom-modal-title" class="text-lg font-black text-slate-900 mb-4">Input</h3>
            <div>
                <label id="custom-modal-label" class="block text-sm font-bold text-slate-600 mb-2">Value:</label>
                <input type="text" id="custom-modal-input" class="w-full rounded-md border-slate-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 p-3 text-lg font-bold">
            </div>
            <div class="mt-6 flex gap-3">
                <button id="custom-modal-ok" class="flex-1 btn-primary py-2 rounded-lg font-bold">OK</button>
                <button id="custom-modal-cancel" class="flex-1 std-btn py-2 rounded-lg">Cancel</button>
            </div>
        </div>
    </div>

    <template id="obs-score-template">
        <select class="w-full text-xs border-none bg-transparent focus:ring-0 p-0 font-medium">
            <option value="">-</option>
            <option value="1">1 (Awake)</option>
            <option value="2">2 (Drowsy)</option>
            <option value="3">3 (Eyes clsd/Voice)</option>
            <option value="4">4 (Eyes clsd/Shake)</option>
            <option value="5">5 (Pain only)</option>
            <option value="6">6 (Unresp)</option>
        </select>
    </template>

    <script src="script.js"></script>
</body>
</html>
